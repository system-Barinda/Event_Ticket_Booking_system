<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Events</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen">

  <!-- ================= NOTIFICATION ================= -->
  <div
    id="notification"
    class="fixed top-6 right-6 z-50 hidden max-w-sm rounded-lg shadow-lg px-4 py-3 text-sm font-medium transition"
  ></div>

  <!-- ================= PAGE CONTAINER ================= -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Page Title -->
    <h1 class="text-2xl sm:text-3xl font-semibold text-gray-800 text-center mb-8">
      Available Events
    </h1>

    <!-- ================= FILTERS ================= -->
    <div class="bg-white rounded-lg shadow-sm p-4 mb-8">
      <div class="flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between">

        <div class="flex flex-col sm:flex-row gap-4 w-full sm:w-auto">
          <select
            id="category"
            class="w-full sm:w-48 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="">All Categories</option>
            <option value="Music">Music</option>
            <option value="Tech">Tech</option>
            <option value="Sports">Sports</option>
          </select>

          <select
            id="city"
            class="w-full sm:w-48 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="">All Cities</option>
            <option value="Kigali">Kigali</option>
            <option value="Huye">Huye</option>
          </select>
        </div>

        <button
          onclick="loadEvents()"
          class="w-full sm:w-auto px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition"
        >
          Apply Filters
        </button>

      </div>
    </div>

    <!-- ================= EVENTS GRID ================= -->
    <div
      id="events"
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
    ></div>

  </div>

<script>
  // ================= NOTIFICATION FUNCTION =================
  function showNotification(message, type = "info") {
    const notif = document.getElementById("notification");

    const styles = {
      success: "bg-green-100 text-green-800 border border-green-300",
      error: "bg-red-100 text-red-800 border border-red-300",
      info: "bg-blue-100 text-blue-800 border border-blue-300",
      warning: "bg-yellow-100 text-yellow-800 border border-yellow-300"
    };

    notif.className = `
      fixed top-6 right-6 z-50 max-w-sm rounded-lg shadow-lg px-4 py-3 text-sm font-medium
      ${styles[type] || styles.info}
    `;

    notif.textContent = message;
    notif.classList.remove("hidden");

    setTimeout(() => {
      notif.classList.add("hidden");
    }, 3000);
  }

  // ================= LOAD EVENTS =================
  async function loadEvents() {
    const category = document.getElementById("category").value;
    const city = document.getElementById("city").value;

    let url = "http://localhost/Event_Ticket_Booking_system/backend/modules/events/read.php";

    const params = new URLSearchParams();
    if (category) params.append("category", category);
    if (city) params.append("city", city);

    if (params.toString()) {
      url += "?" + params.toString();
    }

    const container = document.getElementById("events");
    container.innerHTML = "";

    try {
      const res = await fetch(url);
      const data = await res.json();

      if (!data.success || data.count === 0) {
        container.innerHTML = `
          <p class="text-center text-gray-500 col-span-full">
            No events found.
          </p>
        `;
        showNotification("No events match your filters", "warning");
        return;
      }

      showNotification("Events loaded successfully", "success");

      data.data.forEach(event => {
        container.innerHTML += `
          <div class="bg-white rounded-lg shadow-sm hover:shadow-md transition overflow-hidden">

            <img
              src="http://localhost/Event_Ticket_Booking_system/${event.event_image || 'uploads/default.jpg'}"
              alt="Event image"
              class="w-full h-44 object-cover"
            />

            <div class="p-4">
              <h3 class="text-base font-semibold text-gray-800 mb-1">
                ${event.title}
              </h3>

              <p class="text-sm text-gray-500 mb-1">
                ${event.city} Â· ${event.category}
              </p>

              <p class="text-sm text-gray-500 mb-3">
                Organizer: ${event.organizer}
              </p>

              <span class="inline-flex items-center px-3 py-1 text-xs font-medium rounded-full
                ${event.status === 'approved'
                  ? 'bg-green-100 text-green-700'
                  : 'bg-yellow-100 text-yellow-700'}">
                ${event.status.toUpperCase()}
              </span>
            </div>

          </div>
        `;
      });

    } catch (error) {
      console.error(error);
      showNotification("Failed to load events", "error");
    }
  }

  // Initial load
  loadEvents();
</script>

</body>
</html>