<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Events</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen p-6">

  <!-- Title -->
  <h1 class="text-3xl font-bold text-center mb-8">
    ğŸŸï¸ Available Events
  </h1>

  <!-- Filters -->
  <div class="flex flex-wrap gap-4 justify-center mb-8">
    <select
      id="category"
      class="px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
    >
      <option value="">All Categories</option>
      <option value="Music">Music</option>
      <option value="Tech">Tech</option>
      <option value="Sports">Sports</option>
    </select>

    <select
      id="city"
      class="px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
    >
      <option value="">All Cities</option>
      <option value="Kigali">Kigali</option>
      <option value="Huye">Huye</option>
    </select>

    <button
      onclick="loadEvents()"
      class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
    >
      Filter
    </button>
  </div>

  <!-- Events Grid -->
  <div
    id="events"
    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
  ></div>

  <script>
    async function loadEvents() {
      const category = document.getElementById("category").value;
      const city = document.getElementById("city").value;

      let url = "http://localhost/Event_Ticket_Booking_system/backend/modules/events/read.php";

      const params = new URLSearchParams();
      if (category) params.append("category", category);
      if (city) params.append("city", city);

      if (params.toString()) {
        url += "?" + params.toString();
      }

      const res = await fetch(url);
      const data = await res.json();

      const container = document.getElementById("events");
      container.innerHTML = "";

      if (!data.success || data.count === 0) {
        container.innerHTML = `
          <p class="text-center text-gray-500 col-span-full">
            No events found.
          </p>
        `;
        return;
      }

      data.data.forEach(event => {
        container.innerHTML += `
          <div class="bg-white rounded-xl shadow hover:shadow-lg transition overflow-hidden">
            <img
              src="http://localhost/Event_Ticket_Booking_system/${event.event_image || 'uploads/default.jpg'}"
              alt="Event image"
              class="w-full h-40 object-cover"
            />

            <div class="p-4">
              <h3 class="text-lg font-semibold mb-2">
                ${event.title}
              </h3>

              <p class="text-sm text-gray-600 mb-1">
                ğŸ“ ${event.city} Â· ğŸ—‚ ${event.category}
              </p>

              <p class="text-sm text-gray-600 mb-2">
                ğŸ‘¤ Organizer: ${event.organizer}
              </p>

              <span class="inline-block text-xs font-bold px-3 py-1 rounded-full
                ${event.status === 'approved'
                  ? 'bg-green-100 text-green-700'
                  : 'bg-yellow-100 text-yellow-700'}">
                ${event.status.toUpperCase()}
              </span>
            </div>
          </div>
        `;
      });
    }

    // Load events on page load
    loadEvents();
  </script>

</body>
</html>