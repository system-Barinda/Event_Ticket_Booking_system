<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit Event | Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

  <div class="w-full max-w-2xl bg-white rounded-xl shadow-lg p-6 md:p-8">

    <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">
      Edit Event
    </h2>

    <form id="editForm" enctype="multipart/form-data" class="space-y-4">

      <!-- Hidden Event ID -->
      <input type="hidden" id="event_id" name="event_id">

      <!-- Title -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Title <span class="text-red-500">*</span>
        </label>
        <input
          type="text"
          id="title"
          name="title"
          required
          class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
        >
      </div>

      <!-- Category -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Category <span class="text-red-500">*</span>
        </label>
        <input
          type="text"
          id="category"
          name="category"
          required
          class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
        >
      </div>

      <!-- City -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          City <span class="text-red-500">*</span>
        </label>
        <input
          type="text"
          id="city"
          name="city"
          required
          class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
        >
      </div>

      <!-- Language -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Language
        </label>
        <input
          type="text"
          id="language"
          name="language"
          class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
        >
      </div>

      <!-- Description -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Description
        </label>
        <textarea
          id="description"
          name="description"
          rows="3"
          class="w-full rounded-lg border border-gray-300 px-3 py-2 resize-none focus:ring-2 focus:ring-blue-500 focus:outline-none"
        ></textarea>
      </div>

      <!-- Accessibility Notes -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Accessibility Notes
        </label>
        <textarea
          id="accessibility_notes"
          name="accessibility_notes"
          rows="3"
          class="w-full rounded-lg border border-gray-300 px-3 py-2 resize-none focus:ring-2 focus:ring-blue-500 focus:outline-none"
        ></textarea>
      </div>

      <!-- Status (Admin) -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Status
        </label>
        <select
          id="status"
          name="status"
          class="w-full rounded-lg border border-gray-300 px-3 py-2 bg-white focus:ring-2 focus:ring-blue-500 focus:outline-none"
        >
          <option value="pending">Pending</option>
          <option value="approved">Approved</option>
          <option value="cancelled">Cancelled</option>
        </select>
      </div>

      <!-- Current Image -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Current Image
        </label>
        <img
          id="currentImage"
          src=""
          alt="Event Image"
          class="max-h-48 rounded-lg border"
        >
      </div>

      <!-- Update Image -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Update Image (optional)
        </label>
        <input
          type="file"
          name="event_image"
          accept="image/png, image/jpeg"
          class="block w-full text-sm text-gray-600
                 file:mr-4 file:py-2 file:px-4
                 file:rounded-lg file:border-0
                 file:bg-blue-50 file:text-blue-700
                 hover:file:bg-blue-100"
        >
      </div>

      <!-- Submit -->
      <button
        type="submit"
        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 rounded-lg transition"
      >
        Update Event
      </button>

    </form>

    <!-- Message -->
    <div id="message" class="mt-4 text-center font-medium"></div>

  </div>

<script>
  const params = new URLSearchParams(window.location.search);
  const eventId = params.get("id");

  if (!eventId) {
    alert("Event ID missing");
    window.location.href = "admin-events.html";
  }

  document.getElementById("event_id").value = eventId;

  // Load event
  async function loadEvent() {
    const res = await fetch(
      `http://localhost/Event_Ticket_Booking_system/backend/modules/events/read_one.php?id=${eventId}`
    );
    const result = await res.json();

    if (!result.success) {
      alert(result.message || "Failed to load event");
      return;
    }

    const event = result.data || result.event;

    title.value = event.title;
    category.value = event.category;
    city.value = event.city;
    language.value = event.language || "";
    description.value = event.description || "";
    accessibility_notes.value = event.accessibility_notes || "";
    status.value = event.status || "pending";

    if (event.event_image) {
      currentImage.src =
        `http://localhost/Event_Ticket_Booking_system/${event.event_image}`;
    } else {
      currentImage.classList.add("hidden");
    }
  }

  loadEvent();

  // Update event
  editForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const message = document.getElementById("message");
    const formData = new FormData(editForm);

    const res = await fetch(
      "http://localhost/Event_Ticket_Booking_system/backend/modules/events/update.php",
      { method: "POST", body: formData }
    );

    const data = await res.json();

    if (data.success) {
      message.textContent = data.message;
      message.className = "mt-4 text-center font-medium text-green-600";
      setTimeout(() => {
        window.location.href = "admin-events.html";
      }, 1200);
    } else {
      message.textContent = data.message;
      message.className = "mt-4 text-center font-medium text-red-600";
    }
  });
</script>

</body>
</html>